\documentclass{article}
\usepackage[a4paper, total={7in, 8in}]{geometry}
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}
\usepackage{xcolor}

\begin{document}


\begin{algorithm}
\caption{PreProcess: ./FWI\_PreProcess \{\textcolor{olive}{run\_folder}\}}
\begin{algorithmic}
\State \textcolor{purple}{genericInputCardReader}: Read input from \textcolor{olive}{run\_folder}/input, \textcolor{blue}{gInput} (\textcolor{purple}{genericInput})
\State Start \textcolor{blue}{clock} (\textcolor{purple}{CpuClock})
\Procedure {generateReferencePressureFieldFromChi}{ }
\State Initialize \textcolor{blue}{grid} (\textcolor{purple}{grid2D}), \textcolor{blue}{chi} (\textcolor{purple}{dataGrid2D}),\State \textcolor{blue}{sources} (\textcolor{purple}{sources}), \textcolor{blue}{receivers} (\textcolor{purple}{receivers}), \textcolor{blue}{frequencies} (\textcolor{purple}{frequenciesGroup})
\Procedure {create\_model}{\textcolor{blue}{grid}, \textcolor{blue}{sources}, \textcolor{blue}{receivers}, \textcolor{blue}{frequencies}, \textcolor{blue}{gInput}} 
\State \Comment {{\footnotesize \textcolor{purple}{IntegralForwardModel} from parent \textcolor{purple}{forwardModelInterface}}}
\State Initialize \textcolor{purple}{IntegralForwardModel}(\textcolor{blue}{grid}, \textcolor{blue}{sources}, \textcolor{blue}{receivers}, \textcolor{blue}{frequencies}), \State \textcolor{brown}{\_Greens} (\textcolor{purple}{Greens\_rect\_2D\_cpu}), \textcolor{brown}{\_p0} (\textcolor{purple}{complexDataGrid2D}), \State \textcolor{brown}{\_ptot} (\textcolor{purple}{complexDataGrid2D}), \textcolor{brown}{\_Kappa} (\textcolor{purple}{complexDataGrid2D}),\State \textcolor{brown}{\_fmInput} (\textcolor{purple}{integralForwardModelInput}).
\State \Return \textcolor{blue}{model}
\EndProcedure
\State \textcolor{blue}{model} computes \Call{Ptot}{\textcolor{blue}{chi}}, \Call{Kappa}{ } and \Call{Pdata}{\textcolor{blue}{chi}, \textcolor{blue}{referencePressureData} (\textcolor{purple}{Vector$\langle$Complex$\langle$double$\rangle\rangle$})}
\State Write \textcolor{blue}{referencePressureData} to file \textcolor{teal}{InvertedChiToPressure.text}
\EndProcedure
\State Stop \textcolor{blue}{clock}
\end{algorithmic}
\end{algorithm}

\begin{algorithm}
\caption{Process: ./FWI\_UnifiedProcess \{\textcolor{olive}{run\_folder\}} \{\textcolor{olive}{inversion\_model}\} \{\textcolor{olive}{forward\_model}\}}
\begin{algorithmic}
\State \textcolor{purple}{genericInputCardReader}: Read input from \textcolor{olive}{run\_folder}/input, \textcolor{blue}{gInput} (\textcolor{purple}{genericInput})
\State Start \textcolor{blue}{clock} (\textcolor{purple}{CpuClock})
\Procedure {preformInversion}{...}
\State Initialize \textcolor{blue}{grid} (\textcolor{purple}{grid2D}), \textcolor{blue}{sources} (\textcolor{purple}{sources}), \textcolor{blue}{receivers} (\textcolor{purple}{receivers}), \textcolor{blue}{frequencies} (\textcolor{purple}{frequenciesGroup})
\State \Call{Factory::createForwardModel}{...,\textcolor{olive}{forward\_model}} \Return \textcolor{blue}{forwardmodel}
\State \Comment{{\footnotesize Creates a forwardmodel from parent \textcolor{purple}{forwardModelInterface}}}
\State \Call{Factory::createInversion}{..., \textcolor{olive}{inversion\_model}, \textcolor{blue}{forwardmodel}} \Return \textcolor{blue}{inversionmodel}
\State \Comment{{\footnotesize Creates an inverse model from parent \textcolor{purple}{inversionInterface}}}
\Procedure {\textcolor{blue}{inversionmodel} $\rightarrow$ reconstruct}{ }
\State Initialize all variables
\State Open \textcolor{teal}{residual.log} file to store the residuals
\ForAll {iterations until N\_max}
\State Calculate \textcolor{blue}{kappa} with \textcolor{blue}{forwardmodel} $\rightarrow$ \Call{calculateKappa}{ } \Comment{{\footnotesize $Pdata = Kappa* Chi$}}
\State Calculate \textcolor{blue}{residuals} with \textcolor{blue}{forwardmodel} $\rightarrow$ \Call{calculateResidual}{\textcolor{blue}{chiEstimate}, \textcolor{blue}{pDataReference})}
\State Compute the next \textcolor{blue}{chiEstimate} step according to the inversion model
\State Update \textcolor{blue}{chiEstimate}
\State Compute new \textcolor{blue}{residuals} and write to \textcolor{teal}{residual.log}
\If {\textcolor{blue}{residuals} $<$ \textcolor{blue}{tolerance}}
\State break;
\EndIf
\EndFor
\EndProcedure
\State Write \textcolor{blue}{chiEstimate} to file \textcolor{teal}{chi\_est\_\{}\textcolor{blue}{runName}\textcolor{teal}{\}.txt}
\EndProcedure
\State Stop \textcolor{blue}{clock}
\State \Call{writeplotinput}{...} \Comment{\footnotesize{Creates \textcolor{teal}{\{}\textcolor{blue}{runName}\textcolor{teal}{\}.pythonIn} and \textcolor{teal}{lastRunName.text}, needed for postprocess}}
\end{algorithmic}
\end{algorithm}

\begin{algorithm}
\caption{PostProcess: cp  parallelized-fwi/PythonScripts/PostProcessing-python3.py FWIInstall, python3 PostProcessing-python3.py \{\textcolor{olive}{run\_folder}\} \{\textcolor{olive}{run\_number}\}}
\begin{algorithmic}
\State {\bf \emph {Read}} \textcolor{blue}{runName} from first line in \textcolor{teal}{lastRunName.txt} in outputfolder
\State {\bf \emph {Read}} variables \textcolor{blue}{nxt}, \textcolor{blue}{nzt}, \textcolor{blue}{nxt\_original} and \textcolor{blue}{nzt\_orginal} from \{\textcolor{blue}{runName}\}\textcolor{teal}{.pythonIn} in output folder
\State {\bf \emph {Read}} \textcolor{blue}{chi1} from \textcolor{teal}{chi\_ref\_\{}\textcolor{blue}{runName}\textcolor{teal}{\}.txt} in outputfolder
\State {\bf \emph {Read}} \textcolor{blue}{chi2} from \textcolor{teal}{chi\_est\_\{}\textcolor{blue}{runName}\textcolor{teal}{\}.txt} in outputfolder
\State {\bf \emph {Resize}} the chi of smallest size to the largest size
\State {\bf \emph {Compute}} mean square error and average relative error
\State {\bf \emph {Read}} execution time, virtual memory and physical memmory from \textcolor{teal}{\{}\textcolor{blue}{runName}\textcolor{teal}{\}.pythonIn} in outputfolder
\State {\bf \emph {Create image}} \textcolor{teal}{Results.png} with new, old and differences of chi values
\State {\bf \emph {Create image}} \textcolor{teal}{residuals.png} with residuals over iterations
\Procedure {OutputLogger}{...} \Comment{{\footnotesize from parallelized-fwi/pythonScripts/classes/\textcolor{teal}{OutputLogger.py}}}
\Procedure {Complete\_output\_log} { }
\State {\bf \emph {Read}} kind of image (as temple or dog) used in the procces \State from parallelized-fwi/inputFiles/default/input/\textcolor{teal}{genericInput.json}
\State Also {\bf \emph {read}} grid resolutions (\textcolor{blue}{nGrid} and \textcolor{blue}{nGrid\_original}) and hardwarespecifics from \textcolor{teal}{genericInput.json}
\State {\bf \emph {Read}} description of all methods used and \textcolor{blue}{path} from parallelized-fwi/results/\textcolor{teal}{description\{}\textcolor{olive}{run\_number}\textcolor{teal}{\}.txt} \State and afterward {\bf \emph {remove}} this file
\State {\bf \emph {Get input}} file FWIInstall/\{\textcolor{blue}{path}\}/input/\textcolor{teal}{\{}\textcolor{blue}{inversionmethod}\textcolor{teal}{\}Input.json}
\EndProcedure
\Procedure {Save\_output\_log} { }
\If {parallelized-fwi/results does not exists}
\State {\bf \emph {create directory}}
\EndIf
\State {\bf \emph {write}} log file parallelized-fwi/results/\textcolor{teal}{log\_\{}datetime\textcolor{teal}{\}.json}
\EndProcedure
\EndProcedure
\end{algorithmic}
\end{algorithm}



\end{document}
